{% extends "home/base.html" %}
{% load crispy_forms_tags %}

<!-- main block code -->
{% block content %}

<style>
    body {
        background-color: rgb(202, 202, 202);
    }

    .top-div {
        margin-top: 35px;
        padding-bottom: 20px;
        background-color: rgb(6, 68, 103);
    }

    .test-border {
        border: 2px solid rgb(255, 0, 0);
    }

    .update-card-comment-page {
        margin: 0 20px;
        height: 100%;
        width: calc(100% - 40px);
        color: white;
        overflow-y: auto;

        display: flex;
        flex-direction: column;
    }

    .update-card-title {
        text-align: center;

        display: flex;
        justify-content: center;
        align-items: center;
    }

    .update-card-img-section {
        max-height: 200px;

        display: flex;
        justify-content: center;
        align-items: center;
    }

    .update-card-posted-date {
        margin-top: auto;
    }

    .update-card-comment-btn {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .update-card-comment-btn .btn {
        width: 150px;
        background-color: white;
        color: rgb(6, 68, 103);
        font-weight: 700;
        margin: 10px;
    }


    .comment-form-section, .comment-card {
        margin: 10px;
        padding: 15px;
        border: 1px solid rgb(6, 68, 103);
        box-shadow: 10px 10px 10px rgb(42, 41, 41);
        color: rgb(6, 68, 103);
    }

    .comment-form-section {
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 5% 0;
    }

    .comment-form-section .btn {
        width: 180px;
        background-color: rgb(6, 68, 103);
        color: white;
        font-weight: 700;
    }

    .comment-card {
        border-radius: 10px;
        background-color: rgba(255, 255, 255);
    }

    .comment-card h5 {
        font-weight: 700;
        text-decoration: underline;
    }

    .update-detail-img {
        max-height: 200px;
        max-width: 90%;
        border: 1px solid black;
        border-radius: 5px;
    }

    .comments-section {
        padding-bottom: 80px;
        background-color: rgb(202, 202, 202);
        color: rgb(6, 68, 103);
    }

    .butons-container-back-add {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .admin-response {
        background-color: rgb(240, 239, 186);
        padding: 20px;
        margin: 10px;
        border: 1px solid black;
        border-radius: 10px;
    }

    .add-delete-btn-container {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .add-delete-btn-container .btn {
        width: 120px;
        margin-left: 10px;
        margin-right: 10px;
    }


</style>


<div class="container-fluid top-div">
    <div class="row">
        <div class="col-12 col-lg-8 p-0">
            <div class="update-card-comment-page">
                <div class="update-card-title">
                    <h1 class="m-0 p-1">{{ update.title }}</h1>
                    <hr>
                </div>

                <div class="update-card-content p-3 text-center">
                    <div><h5>{{ update.topic }}</h5></div>
                    <hr>
                    <div>{{ update.content|linebreaksbr }}</div>
                </div>

                {% if update.update_image %}
                    <div class="update-card-img-section">
                        <img class="update-detail-img" src="{{ update.update_image.url }}" alt="">
                    </div>
                {% endif %}

                <div class="update-card-posted-date p-3 text-center">
                    <hr>
                    <div><strong>PUBLISHED: </strong>{{ update.published_on|date:"dS M Y" }}</div>
                </div>

                <div class="butons-container-back-add">
                    <div class="update-card-comment-btn">
                        <a class="btn" href="{% url 'all-admin-updates' %}">Site Updates</a>

                    </div>
    
                    <div class="update-card-comment-btn d-lg-none">
                        <a class="btn" href="{% url 'comment-create' update.pk %}">Add Comment</a>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="d-none d-lg-inline col">
            <div class="comment-form-section">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <fieldset class="form-group">
                        <legend class="border-bottom mb-4">Add Comment</legend>
                        {{ comment_form|crispy }}
                    </fieldset>
                    <div class="form-group">
                        <button class="btn btn-comment-submit" type="submit">Submit Comment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="comments-section">
    <h3 class="text-center pt-3 mt-2">COMMENTS</h3>
    {% for comment in comments %}
        <div class="comment-card text-center">
            <h5>{{ comment.title }}</h5>
            <div><small><strong>Posted:</strong> {{ comment.created_on|date:"dS F Y (P)" }}</small></div>
            {% if comment.updated_on %}
                <div><small><strong>Updated:</strong> {{ comment.updated_on|timesince }} ago</small></div>
            {% endif %}

            <hr>
            <div class="comments-txt">{{ comment.comment|linebreaksbr }}</div>

            {% if comment.comment_image %}
                <div class="update-card-img-section mt-3">
                    <img class="update-detail-img" src="{{ comment.comment_image.url }}" alt="">
                </div>
            {% endif %}


            {% if comment.action_taken %}
            <div class="admin-response">
                <h6><strong>ADMIN RESPONSE</strong></h6>
                <div><strong>ACTION TAKEN: </strong>{{ comment.action_taken }}</div>
    
                {% if comment.action_image %}
                    <div class="update-card-img-section mt-3">
                        <img class="update-detail-img" src="{{ comment.action_image.url }}" alt="">
                    </div>
                {% endif %}

            </div>
            {% endif %}

            {% if user == comment.author %}
            <hr>
            <div class="add-delete-btn-container">
                <a class="btn btn-success" href="{% url 'comment-update' comment.pk %}">Update</a>
                <a class="btn btn-danger" href="{% url 'comment-delete' comment.pk %}">Delete</a>
            </div>
            {% endif %}        
        </div>
    {% endfor %}


    {% if comments.count == 0 %}
        <div class="comment-card text-center">
            <div class="comments-txt">No Comments</div>
        </div>

    {% endif %}

</div>

{% endblock %}
